<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Button Folding Into Bird</title>
    <style>
        .button {
            --primary: #758A93;
            --primary-dark: #5A6B73;
            --primary-darkest: #4A565D;
            --text: #FFFFFF;
            --text-opacity: 1;
            --success: #2B3044;
            --success-scale: 0.2;
            --success-opacity: 0;
            --border-radius: 7;
            --overflow: hidden;
            --rotate: 0;
            --plane-x: 0;
            --plane-y: 0;
            --plane-opacity: 1;
            --left-wing-background: var(--primary);
            --left-wing-first-x: 0;
            --left-wing-first-y: 0;
            --left-wing-second-x: 50;
            --left-wing-second-y: 0;
            --left-wing-third-x: 0;
            --left-wing-third-y: 100;
            --left-body-background: var(--primary);
            --left-body-first-x: 50;
            --left-body-first-y: 0;
            --left-body-second-x: 50;
            --left-body-second-y: 100;
            --left-body-third-x: 0;
            --left-body-third-y: 100;
            --right-wing-background: var(--primary);
            --right-wing-first-x: 50;
            --right-wing-first-y: 0;
            --right-wing-second-x: 100;
            --right-wing-second-y: 0;
            --right-wing-third-x: 100;
            --right-wing-third-y: 100;
            --right-body-background: var(--primary);
            --right-body-first-x: 50;
            --right-body-first-y: 0;
            --right-body-second-x: 50;
            --right-body-second-y: 100;
            --right-body-third-x: 100;
            --right-body-third-y: 100;
            display: block;
            cursor: pointer;
            position: relative;
            border: 0;
            padding: 8px 0;
            min-width: 100px;
            text-align: center;
            margin: 0;
            line-height: 24px;
            font-family: inherit;
            font-weight: 500;
            font-size: 14px;
            background: none;
            outline: none;
            color: var(--text);
            transform: rotate(calc(var(--rotate) * 1deg)) translateZ(0);
            -webkit-appearance: none;
            -webkit-tap-highlight-color: transparent;
            z-index: 1;
        }

        .button .left,
        .button .right {
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            opacity: var(--plane-opacity);
            transform: translate(calc(var(--plane-x) * 1px), calc(var(--plane-y) * 1px)) translateZ(0);
        }

        .button .left:before,
        .button .left:after,
        .button .right:before,
        .button .right:after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            border-radius: calc(var(--border-radius) * 1px);
            transform: translate(var(--x, 0.4%), var(--y, 0)) translateZ(0);
            z-index: var(--z-index, 2);
            background: var(--background, var(--left-wing-background));
            clip-path: polygon(
                calc(var(--first-x, var(--left-wing-first-x)) * 1%) calc(var(--first-y, var(--left-wing-first-y)) * 1%), 
                calc(var(--second-x, var(--left-wing-second-x)) * 1%) calc(var(--second-y, var(--left-wing-second-y)) * 1%), 
                calc(var(--third-x, var(--left-wing-third-x)) * 1%) calc(var(--third-y, var(--left-wing-third-y)) * 1%)
            );
        }

        .button .left:after {
            --x: 0;
            --z-index: 1;
            --background: var(--left-body-background);
            --first-x: var(--left-body-first-x);
            --first-y: var(--left-body-first-y);
            --second-x: var(--left-body-second-x);
            --second-y: var(--left-body-second-y);
            --third-x: var(--left-body-third-x);
            --third-y: var(--left-body-third-y);
        }

        .button .right:before {
            --x: -0.4%;
            --z-index: 2;
            --background: var(--right-wing-background);
            --first-x: var(--right-wing-first-x);
            --first-y: var(--right-wing-first-y);
            --second-x: var(--right-wing-second-x);
            --second-y: var(--right-wing-second-y);
            --third-x: var(--right-wing-third-x);
            --third-y: var(--right-wing-third-y);
        }

        .button .right:after {
            --x: 0;
            --z-index: 1;
            --background: var(--right-body-background);
            --first-x: var(--right-body-first-x);
            --first-y: var(--right-body-first-y);
            --second-x: var(--right-body-second-x);
            --second-y: var(--right-body-second-y);
            --third-x: var(--right-body-third-x);
            --third-y: var(--right-body-third-y);
        }

        .button span {
            display: block;
            position: relative;
            z-index: 4;
            opacity: var(--text-opacity);
        }

        .button span.success {
            z-index: 0;
            position: absolute;
            left: 0;
            right: 0;
            top: 8px;
            transform: rotate(calc(var(--rotate) * -1deg)) scale(var(--success-scale)) translateZ(0);
            opacity: var(--success-opacity);
            color: var(--success);
        }

        html {
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        * {
            box-sizing: inherit;
        }

        *:before,
        *:after {
            box-sizing: inherit;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Inter', Arial, sans-serif;
            background: #E1E6F9;
            position: relative;
            overflow: hidden;
        }
        
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <canvas id="three-canvas"></canvas>
    
    <button class="button">
        <span class="default">Send</span>
        <span class="success">Sent</span>
        <div class="left"></div>
        <div class="right"></div>
    </button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script>
        // Three.js Bird Geometry
        function Bird() {
            const geometry = new THREE.BufferGeometry();
            
            const vertices = new Float32Array([
                5, 0, 0,
                -5, -2, 1,
                -5, 0, 0,
                -5, -2, -1,
                
                0, 2, -6,
                0, 2, 6
            ]);
            
            const indices = new Uint16Array([
                0, 1, 2,
                0, 2, 3,
                0, 3, 4,
                0, 4, 1
            ]);
            
            geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));
            geometry.setIndex(new THREE.BufferAttribute(indices, 1));
            
            return geometry;
        }

        // Boid class with physics
        var Boid = function() {
            var vector = new THREE.Vector3();
            var _acceleration;
            var _maxSpeed = 2; // Slower speed
            var _maxSteerForce = 0.05; // Gentler steering

            this.position = new THREE.Vector3();
            this.velocity = new THREE.Vector3();
            _acceleration = new THREE.Vector3();

            this.setGoal = function(target) {
                var steer = new THREE.Vector3();
                steer.subVectors(target, this.position);
                steer.multiplyScalar(0.003); // Slower acceleration
                _acceleration.add(steer);
            }

            this.move = function() {
                this.velocity.add(_acceleration);
                var l = this.velocity.length();
                if (l > _maxSpeed) {
                    this.velocity.divideScalar(l / _maxSpeed);
                }
                this.position.add(this.velocity);
                _acceleration.set(0, 0, 0);
            }
        }

        // Three.js setup
        let scene, camera, renderer, bird, boid;
        let threeJsActive = false;
        let waypoints = [];
        let currentWaypoint = 0;

        function initThreeJS() {
            scene = new THREE.Scene();
            camera = new THREE.OrthographicCamera(
                window.innerWidth / -2, window.innerWidth / 2,
                window.innerHeight / 2, window.innerHeight / -2,
                1, 1000
            );
            camera.position.z = 450;

            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('three-canvas'),
                alpha: true,
                antialias: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);

            const birdGeometry = new Bird();
            const birdMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x758A93, 
                side: THREE.DoubleSide 
            });
            bird = new THREE.Mesh(birdGeometry, birdMaterial);
            bird.scale.set(2.5, 2.5, 2.5);
            bird.phase = 0;
            scene.add(bird);

            boid = new Boid();
        }

        function createLoopWaypoints(startX, startY) {
            const points = [];
            const numPoints = 20;
            const loopRadius = 100;
            
            // Get screen dimensions to ensure bird exits completely
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const exitDistance = Math.max(screenWidth, screenHeight) * 1.5; // 1.5x screen size to ensure complete exit
            
            console.log('Start position:', startX, startY);
            console.log('Screen size:', screenWidth, screenHeight);
            
            // Create path: fly UP, loop-de-loop, exit bottom right off screen
            for (let i = 0; i <= numPoints; i++) {
                const t = i / numPoints;
                let x, y;
                
                if (t < 0.3) {
                    // Fly UPWARD - try POSITIVE Y to go up
                    const t1 = t / 0.3;
                    x = startX + t1 * 80;
                    y = startY + t1 * 200; // POSITIVE Y = UP
                } else if (t < 0.7) {
                    // Complete the loop-de-loop
                    const t2 = (t - 0.3) / 0.4;
                    const angle = t2 * Math.PI * 2;
                    const loopCenterX = startX + 150;
                    const loopCenterY = startY + 200; // Loop center at the top position
                    x = loopCenterX + Math.sin(angle) * loopRadius;
                    y = loopCenterY - Math.cos(angle) * loopRadius; // This creates the circular loop
                } else {
                    // Exit toward bottom right - fly FAR off screen
                    const t3 = (t - 0.7) / 0.3;
                    x = startX + 250 + t3 * exitDistance;
                    y = startY + 100 - t3 * exitDistance; // Move down and right off screen
                }
                
                if (i < 5) console.log('Waypoint', i, ':', x, y);
                points.push(new THREE.Vector3(x, y, 0));
            }
            
            return points;
        }

        function animateThreeJS() {
            if (!threeJsActive) return;
            requestAnimationFrame(animateThreeJS);

            // Use boid physics to smoothly move toward next waypoint
            if (currentWaypoint < waypoints.length) {
                const target = waypoints[currentWaypoint];
                boid.setGoal(target);
                boid.move();
                
                bird.position.copy(boid.position);
                
                // Move to next waypoint when close enough
                if (boid.position.distanceTo(target) < 30) {
                    currentWaypoint++;
                }
                
                // Calculate rotation based on velocity
                bird.rotation.y = Math.atan2(-boid.velocity.z, boid.velocity.x);
                bird.rotation.z = Math.asin(boid.velocity.y / boid.velocity.length());
                
                // Wing flapping
                bird.phase = (bird.phase + (Math.max(0, bird.rotation.z) + 0.1)) % 6.28;
                const flapAmount = Math.sin(bird.phase) * 5;
                bird.geometry.attributes.position.array[13] = flapAmount;
                bird.geometry.attributes.position.array[16] = flapAmount;
                bird.geometry.attributes.position.needsUpdate = true;
            } else {
                // Animation complete
                threeJsActive = false;
                const button = document.querySelector('.button');
                setTimeout(() => {
                    button.removeAttribute('style');
                    gsap.fromTo(button, {
                        opacity: 0,
                        y: -8
                    }, {
                        opacity: 1,
                        y: 0,
                        clearProps: true,
                        duration: 0.3,
                        onComplete() {
                            button.classList.remove('active');
                        }
                    });
                }, 500);
            }

            renderer.render(scene, camera);
        }

        initThreeJS();

        // Button animation - fold into BIRD shape
        document.querySelectorAll('.button').forEach(button => {
            let getVar = variable => getComputedStyle(button).getPropertyValue(variable);

            button.addEventListener('click', e => {
                if(!button.classList.contains('active')) {
                    button.classList.add('active');

                    // Get button position
                    const rect = button.getBoundingClientRect();
                    const buttonCenterX = rect.left + rect.width / 2 - window.innerWidth / 2;
                    const buttonCenterY = -(rect.top + rect.height / 2 - window.innerHeight / 2);

                    // Bird fold - matching boid structure with triangular wings
                    gsap.to(button, {
                        keyframes: [{
                            // Collapse to center
                            '--left-wing-first-x': 50,
                            '--left-wing-first-y': 50,
                            '--left-wing-second-x': 50,
                            '--left-wing-second-y': 50,
                            '--left-wing-third-x': 50,
                            '--left-wing-third-y': 50,
                            '--right-wing-first-x': 50,
                            '--right-wing-first-y': 50,
                            '--right-wing-second-x': 50,
                            '--right-wing-second-y': 50,
                            '--right-wing-third-x': 50,
                            '--right-wing-third-y': 50,
                            '--border-radius': 0,
                            duration: 0.3
                        }, {
                            // Bird shape - like boid geometry (diagonal view, nose upper-right)
                            '--rotate': 50,
                            
                            // Left wing - large triangle
                            '--left-wing-first-x': 60,   // connects to body
                            '--left-wing-first-y': 45,
                            '--left-wing-second-x': 15,  // wing tip (far left)
                            '--left-wing-second-y': 65,
                            '--left-wing-third-x': 50,   // back of body
                            '--left-wing-third-y': 55,
                            
                            // Right wing - large triangle
                            '--right-wing-first-x': 60,  // connects to body
                            '--right-wing-first-y': 45,
                            '--right-wing-second-x': 80, // wing tip (right)
                            '--right-wing-second-y': 55,
                            '--right-wing-third-x': 50,  // back of body
                            '--right-wing-third-y': 55,
                            
                            // Body - small triangle pointing upper-right (nose)
                            '--left-body-first-x': 60,
                            '--left-body-first-y': 43,
                            '--left-body-second-x': 70,  // nose tip
                            '--left-body-second-y': 40,
                            '--left-body-third-x': 60,
                            '--left-body-third-y': 47,
                            
                            '--right-body-first-x': 60,
                            '--right-body-first-y': 43,
                            '--right-body-second-x': 70,
                            '--right-body-second-y': 40,
                            '--right-body-third-x': 60,
                            '--right-body-third-y': 47,
                            
                            duration: 0.3
                        }]
                    });

                    // Wing flapping animation
                    const flapTimeline = gsap.timeline({ delay: 1.0 });
                    
                    // Flap 3 times - wings sweep up and down
                    for (let i = 0; i < 3; i++) {
                        flapTimeline.to(button, {
                            // Wings up
                            '--left-wing-second-y': 55,
                            '--right-wing-second-y': 45,
                            duration: 0.2,
                            ease: "power2.out"
                        }).to(button, {
                            // Wings down  
                            '--left-wing-second-y': 70,
                            '--right-wing-second-y': 60,
                            duration: 0.2,
                            ease: "power2.in"
                        });
                    }
                    
                    // After flapping, transition to Three.js
                    flapTimeline.to(button, {
                        '--plane-opacity': 0,
                        duration: 0.2,
                        onComplete() {
                            // Start Three.js bird with physics
                            boid.position.set(buttonCenterX, buttonCenterY, 0);
                            boid.velocity.set(0.5, -0.5, 0);
                            waypoints = createLoopWaypoints(buttonCenterX, buttonCenterY);
                            currentWaypoint = 0;
                            threeJsActive = true;
                            animateThreeJS();
                        }
                    });

                    // Color changes
                    gsap.to(button, {
                        keyframes: [{
                            '--text-opacity': 0,
                            '--left-wing-background': getVar('--primary-darkest'),
                            '--right-wing-background': getVar('--primary-darkest'),
                            duration: 0.1
                        }, {
                            '--left-wing-background': getVar('--primary'),
                            '--right-wing-background': getVar('--primary'),
                            duration: 0.1
                        }, {
                            '--left-body-background': getVar('--primary-dark'),
                            '--right-body-background': getVar('--primary-darkest'),
                            duration: 0.4
                        }, {
                            '--success-opacity': 1,
                            '--success-scale': 1,
                            duration: 0.25,
                            delay: 0.25
                        }]
                    });
                }
            });
        });

        window.addEventListener('resize', () => {
            camera.left = window.innerWidth / -2;
            camera.right = window.innerWidth / 2;
            camera.top = window.innerHeight / 2;
            camera.bottom = window.innerHeight / -2;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>

